<% title @weapon.name %>
<h1><%= @weapon.name %></h1>
<hr>
<% if logged_in? %>
  <%= render partial: '/weapons/obtain_form' %>
<% end %>

<p><%= @weapon.description %></p>
  <h2>Example rolls:</h2>
<ul class='no-dots'>
  <li>Example block numbers: <%= @character.generate_defense_string(@weapon) %></li>
  <% @attack_options.each do |attack_option| %>
    <h3><%= attack_option.name %>:</h3>
    <li>Example attack numbers: <%= @character.generate_attack_string(attack_option) %></li>
    <li>Example damage numbers: <%= @character.generate_damage_string(attack_option) %></li>
    <% attack_option.attack_options_conditions.each do |aoo_c| %>
      <li>Will trigger <%= aoo_c.condition.name %> at <%= aoo_c.threshold %> points of damage</li>
    <% end %>
  <% end %>
</ul>

<h2>Stats:</h2>

<ul class='no-dots weapon-stats'>
  <li>Creator: <%= link_to @weapon.user.username, @weapon.user %></li>
  <li>Weapon Type: <%= link_to @weapon.weapon_type.name, @weapon.weapon_type %></li>
  <li>Weapon Class: <%= @weapon.weapon_classes.map {|w| w.name}.join(', ') %></li>
  <li>Defense die number: <%= @weapon.defense_die_number %></li>
  <li>Defense die size: <%= @weapon.defense_die_size %></li>
  <li>Flat defense bonus: <%= @weapon.flat_defense_bonus %></li>
  <li>Defense energy modifier: <%= @weapon.defense_energy_modifier %></li>
  <li>Extra attack cost: <%= @weapon.extra_attack_cost %></li>
  <li>Extra Block Cost: <%= @weapon.extra_block_cost %></li>
  <li>Hands required: <%= @weapon.hands_used %></li>
  <li>Dodge energy modifier penalty: <%= @weapon.dodge_energy_mod_penalty %></li>
</ul>
<h2>Attack Options: </h2>
<% @attack_options.each do |attack_option| %>
<%= render partial: '/attack_options/show', locals: {attack_option: attack_option} %>
<% end %>
<% if @attack_options.empty? %>
  <p>There are currently no attack options for this weapon.</p>
<% end %>
<% if logged_in? && @weapon.user == current_user %>
  <%= link_to "add #{@weapon.attack_options.empty? ? 'an' : 'another'} attack option", new_weapon_attack_option_path(@weapon) %>
<% end %>


<% if @weapon.user == current_user %>
  <table>
    <tr>
      <td><%= @empty ? 'No characters are currently using this weapon' : "#{@weapon.inventories.length} characters have this weapon in their inventories. You cannot modify it" %></td>
    </tr>
    <tr>
      <td>
        <%= form_for @weapon, method: 'delete' do |f| %>
            <%= f.submit "Delete #{@weapon.name}", disabled: !@empty %>
          <% end %>
      </td>
    </tr>
    <tr>
      <td>
      <%= form_for @weapon, url: (@weapon.weapon_classes.any? {|weapon_class| weapon_class.name.downcase.include?('shield')} ? "/weapons/#{@weapon.id}/edit/shield" : edit_weapon_path(@weapon)), method: 'get' do |f| %>
          <%= f.submit "Edit #{@weapon.name}", disabled: !@empty %>
        <% end %>
    </td>
    </tr>
    <% @attack_options.each do |a_o| %>
      <tr>
        <td>
          <%= form_for [@weapon, a_o], url: edit_weapon_attack_option_path(@weapon, a_o), method: 'get' do |f| %>
            <%= f.submit "Edit #{a_o.name}", disabled: !@empty %>
          <% end %>
        </td>
      </tr>
    <% end %>


  </table>
<% end %>
